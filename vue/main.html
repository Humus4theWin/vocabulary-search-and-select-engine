<script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>

<div id="app">
    <h1>Frontend Search</h1>
    <div>
        <div v-for="vocab in Object.keys(vocabs)">
            <div v-bind:class="vocabs[vocab].data ? 'loaded':''">
                {{ vocab}} 
            </div>
        </div>
    </div>
    </button>
</div>


<script>
 var app = new Vue({
        el: '#app',
        data: {
            vocabs:{}
        },
        // load all vocabs
        async created (){
            let vocabList =  await fetch('/vocabs').then(data => data.json())
            let promises = vocabList.map(
                url => this.this.importVocab(url).then(
                // then process
                vocab => this.storeVocab(vocab,url)))
 
            await Promise.all(promises)

            //trigger processing
        },
        watch:{
            vocabs:function(val){
                console.log(val)
             },
        },
        methods: {
            async loadVocab(url){
                let vocab = {};

                let response;
                try{
                    // load from remote server
                    response = await fetch(url)
                }catch(ex){
                    // if fails, load via proxy
                    response = await fetch('/proxy',{
                        headers: {url: url},
                    })
                }
                if(response.ok){
                    vocab.type =  response.headers.get("content-type")
                    vocab.data = await response.text();
                }else{
                    console.log("error: "+url)
                }
                return vocab;
            },
            storeVocab(vocab,url){
                this.vocabs = {...this.vocabs, [url]:vocab}
            }
        }
    })
</script>

<style>

.loaded{
    background-color: lightgreen;
}




</style>